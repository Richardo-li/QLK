<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!-- 理想视窗 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1,minimum-scale=1,user-scalable=no">
  <title>个人中心</title>
  <link rel="shortcut icon" href="jd.ico" />
  <!-- 添加ico -->
  <link rel="stylesheet" href="mobile/lib/mui/css/mui.min.css" />
  <!-- <link rel="stylesheet" href="lib/fontAwesome/css/font-awesome.min.css" /> -->
  <!-- 字体图标用阿里巴巴的 或者 Mui icon图标 -->
  <link rel="stylesheet" href="mobile/css/common.css" />
  <!-- 公共样式 顶部侧滑的是公共的-->
  <link rel="stylesheet" href="mobile/css/personalCenter.css" />
</head>

<body>

  <!-- 侧滑导航根容器 -->
  <div class="mui-off-canvas-wrap mui-draggable mui-slide-in">
    <!-- 菜单容器 -->
    <aside class="mui-off-canvas-right">
      <div id="offCanvasSideScroll" class="mui-scroll-wrapper">
        <div class="mui-scroll">
          <!-- 菜单具体展示内容 -->

          <p style="color:white;font-size:.38rem;margin:.2rem 0 .2rem .2rem;">宗旨</p>
          <div style="color:#bbb;font-size:.23rem;padding:0 .2rem .2rem .2rem;text-align:left;">
            千旅客网致力建设成为背包客驴友穷游时提供最全面最方便的旅行信息和服务。
          </div>
          <ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted menu">
            <li class="mui-table-view-cell">
              <a href="/#" class="mui-navigate-right">
                首页
              </a>
            </li>
            <li class="mui-table-view-cell">
              <a href="/register" class="mui-navigate-right">
                注册
              </a>
            </li>
            <li class="mui-table-view-cell">
              <a href="/login" class="mui-navigate-right">
                登录
              </a>
            </li>
            <li class="mui-table-view-cell">
              <a href="/personalCenter" class="mui-navigate-right">
                个人中心
              </a>
            </li>
          </ul>

          <button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 10px;margin-top:40px;">关闭侧滑菜单</button>

        </div>
      </div>
    </aside>
    <!-- 主页面容器 -->
    <div class="mui-inner-wrap">
      <!-- 主页面标题 -->
      <header class="mui-bar mui-bar-nav">
        <span id="left-menu" class="mui-icon mui-action-menu mui-icon-bars mui-pull-right"></span>

        <a href="javascript:history.go(-1)" class="mui-icon mui-icon-back" style="color:black"></a>

        <h1 class="mui-title">个人中心</h1>

      </header>
      <div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
        <div class="mui-scroll">

          {{each personalCenterData}}
          <!-- 头像部分 -->
          <ul class="mui-table-view mui-table-view-chevron" id="mui-ellipsis">
            <li class="mui-table-view-cell mui-media">
              <a class="mui-navigate-right" href="javascript:;">

                <img class="mui-media-object mui-pull-left head-img" id="head-img" src="mobile/images/{{$value.Headportrait}}">
                <div class="mui-media-body">
                  {{$value.LoginName}}
                  <p class='mui-ellipsis'>
                    <!-- <div type="button" href="/editHeadportrait" id="editHeadportrait" style='padding: 1px 10px;' class="mui-btn mui-btn-royal mui-btn-outlined">修改头像</div> -->
                  </p>
                </div>
              </a>
            </li>
          </ul>
          <form action="">
            <ul class="mui-table-view">
              <li class="mui-table-view-cell mui-collapse">
                <a class="mui-navigate-right" href="#">个人资料</a>
                <div class="mui-collapse-content">
                  <form class="mui-input-group">
                    <div class="mui-input-row">
                      <label>真实姓名</label>
                      <input type="text" placeholder="请填写姓名" id='MemberName' maxlength="10" value={{$value.MemberName}}>
                    </div>
                    <div class="mui-input-row">
                      <label>手机号码</label>
                      <input type="number" placeholder="请填写手机号" id="Phone" maxlength="10" value={{$value.Phone}}>
                      <!-- input  设置成tel,maxlength=11 , 移动端唤起数字键盘，且限制长度的maxlength有效 -->
                    </div>
                    <div class="mui-input-row">
                      <label>住址</label>
                      <input type="text" placeholder="请填写住址" id="Address" maxlength="26" value={{$value.Address}}>
                    </div>
                    <div class="mui-input-row">
                      <label>Email</label>
                      <input type="text" placeholder="请填写Email" id='Email' max="20" value={{$value.Email}}>
                    </div>
                    <div class="mui-input-row">
                      <label>生日</label>
                      <input type="text" placeholder="请填写生日" id='BirthDate' value={{$value.BirthDate}}>
                    </div>
                    <div class="mui-input-row">
                      <label>QQ</label>
                      <input type="text" placeholder="请填写QQ" id="QQ" maxlength="16" value={{$value.QQ}}>
                    </div>

                    <div class="mui-input-row mui-radio mui-left">
                      <label>男</label>
                      {{if $value.Sex=='男'}}
                      <input name="radio1" type="radio" checked class="rds1" value="男"> {{/if}}
                      <input name="radio1" type="radio" class="rds1" value="男">
                    </div>
                    <div class="mui-input-row mui-radio mui-left">
                      <label>女</label>
                      {{if $value.Sex=='女'}}
                      <input name="radio1" type="radio" checked class="rds2" value="女"> {{/if}}
                      <input name="radio1" type="radio" class="rds2" value="女">
                    </div>

                    <div class="mui-button-row">
                      <button class="mui-btn mui-btn-primary" type="button" id="edit">更新</button>&nbsp;&nbsp;
                    </div>
                  </form>
                  {{/each}}

                </div>
              </li>
              <li class="mui-table-view-cell mui-collapse">
                <a class="mui-navigate-right" href="#" id='published'>我发表的</a>
                <div class="mui-collapse-content">
                  <ul id="info">

                  </ul>
                </div>
              </li>
              <li class="mui-table-view-cell mui-collapse">
                <a class="mui-navigate-right" href="#">关于我们</a>
                <div class="mui-collapse-content">
                  <p>
                    千旅客网致力建设成为背包客驴友穷游时提供最全面最方便的旅行信息和服务。
                  </p>
                </div>
              </li>
            </ul>



            <ul class="mui-table-view">
              <li class="mui-table-view-cell" style="text-align: center;" id="logout">
                <span>退出登录</span>
              </li>
            </ul>

          </form>



        </div>
      </div>
    </div>

  </div>
  </div>
  </div>
  </div>


</body>

</html>
<script src="mobile/lib/zepto/zepto.min.js"></script>
<!-- 移动端jquery -->
<script src="mobile/lib/mui/js/mui.min.js"></script>
<!-- mui -->
<script src="mobile/lib/artTemplate/template-native.js"></script>
<!-- 模板引擎，不用拼接字符串 -->
<script src="mobile/js/common.js"></script>
<!-- 公共js工具 包括 全局ajax工具函数 -->
<script>
  $(function () {

    //跳转页面
    $('#mui-ellipsis').on('tap', function () {
      window.location.href = "/editHeadportrait";
      return false;
    })

    //修改个人资料
    $('#edit').on('tap', function () {

      var data = {
        MemberName: $('#MemberName')[0].value.trim(),
        Phone: $('#Phone')[0].value.trim(),
        Address: $('#Address')[0].value.trim(),
        Email: $('#Email')[0].value.trim(),
        BirthDate: $('#BirthDate')[0].value.trim(),
        QQ: $('#QQ')[0].value.trim(),
        Sex: $("input[type='radio']:checked").val()
      }

      // console.log(data);

      $.ajax({
        type: 'post',
        url: "/editPersonal",
        data: data,
        dataType: "json",
        success: function (result) {
          if (result.code == 200) {
            mui.toast(result.msg);
          } else {
            mui.toast(result.msg);
          }
        }
      });


    })

    //退出登录
    $('#logout').on('tap', function () {
      mui.confirm(`确定退出？`, '您点击了退出按钮', ['否', '是'], function (e) {
        if (e.index == 1) {
          // window.location.href = "/personalCenter";
          $.ajax({
            type: 'get',
            url: '/logout',
            dataType: 'json',
            success: function (result) {
              if (result.code == 200) {
                mui.toast(result.msg);
                window.location.href = "/";
              } else {
                mui.toast(result.msg);
              }
            }
          })

        } else {
          return;
          // window.location.href = "/";
        }
      })
    })

    function getPublished() {
      $.ajax({
        type: 'get',
        url: "/published",
        dataType: "json",
        success: function (result) {
          if (result.code == 200) {
            var html = '';
            for (let i = 0; i < result.data.length; i++) {
              html += `<li class="mui-table-view-cell mui-transitioning" >
                          <div class="mui-slider-left mui-disabled">
                             <a class="mui-btn mui-btn-red delete" CP_ID='${result.data[i].CP_ID}' style="transform: translate(0px, 0px);" href='javascript:;'>删除</a>
                          </div>
                          <div class="mui-slider-handle" style="transform: translate(0px, 0px);">
                            <a href="/companionDetail?CP_ID=${result.data[i].CP_ID}"  style='color:black'>
                             ${result.data[i].Title}
                            </a>
                          </div>
                       </li>`;
            }
            $('#info').html(html);
          } else {
            mui.toast('获取信息失败！');
          }
        }
      });
    }

    //获取 当前会员发表过的文章
    $('#published').on('tap', function () {
      getPublished();
    })

    //删除发布的结伴信息     使用了jQuery事件委托
    $('#info').on('tap', '.delete', function () {
      // console.log($(this).attr('CP_ID'));
      var CP_ID = $(this).attr('CP_ID');
      mui.confirm(`删除后不可恢复`, '是否删除？', ['否', '是'], function (e) {
        if (e.index == 1) {
          $.ajax({
            type: 'post',
            data: 'CP_ID=' + CP_ID,
            url: '/deleteCompanion',
            dataType: 'json',
            success: function (result) {
              if (result.code == 200) {
                mui.toast(result.msg);
                getPublished();
                // window.location.href = "/";
              } else {
                mui.toast(result.msg);
              }
            }
          })

        } else {
          return;
        }
      })


    })








  })
</script>